import type { Metadata } from "next";
import { redirect } from "next/navigation";

import { currentUser } from "@clerk/nextjs";
import { Box, Container } from "@mantine/core";

import { prisma } from "@/lib/prisma";

import FixedButton from "./_components/fixed-button";
import Header from "./_components/header";

export const metadata: Metadata = {
  title: "Timeline | All",
  description: "Generated by create next app",
};

export default async function TimelineLayout({
  children,
}: Readonly<{
  children: React.ReactNode;
}>) {
  const user = await currentUser();

  if (!user) {
    redirect("/sign-in");
  }

  const userLatestPost = await prisma.post.findFirst({
    where: {
      user_id: user.id,
    },
    orderBy: { created_at: "desc" },
  });

  // Fix remove waste featch maybe
  const projects = await prisma.project.findMany({
    where: {
      user_id: user.id,
    },
  });

  const projectTitleArr = projects.map((project) => project.title);

  const isPostedToday =
    userLatestPost?.created_at.getDate() !== new Date().getDate();

  return (
    <Container size={"md"} mih={"100dvh"} pos={"relative"}>
      <Header />

      <Box w={{ base: "100%", xs: 576, sm: 576, md: 768 }} mx={"auto"}>
        {children}
      </Box>

      <FixedButton />
    </Container>
  );
}
